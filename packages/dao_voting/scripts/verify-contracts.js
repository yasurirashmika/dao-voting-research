require("dotenv").config(); // IMPORTANT: This is required to read your .env file
const hre = require("hardhat");

const DEPLOYED_ADDRESSES = {
  governanceToken: process.env.GOVERNANCE_TOKEN_ADDRESS,
  reputationManager: process.env.REPUTATION_MANAGER_ADDRESS,
  daoVoting: process.env.DAO_VOTING_ADDRESS,
  // Added your private contracts from the .env file:
  voteVerifier: process.env.VOTE_VERIFIER_ADDRESS,
  didRegistry: process.env.DID_REGISTRY_ADDRESS,
  privateDaoVoting: process.env.PRIVATE_DAO_VOTING_ADDRESS 
};

const DEPLOYER_ADDRESS = "0xF2d47208f7c21a143FbDED47e7f260593d901F57"; 

async function main() {
  console.log("Verifying contracts on Etherscan...");

  // 1. Verify Governance Token
  console.log("\n1. Verifying GovernanceToken...");
  try {
      await hre.run("verify:verify", {
      address: DEPLOYED_ADDRESSES.governanceToken,
      constructorArguments: [
          "DAO Governance Token",
          "DGT",
          DEPLOYER_ADDRESS
      ],
      });
      console.log("GovernanceToken verified successfully!");
  } catch (e) {
      console.log("GovernanceToken verification failed or already verified:", e.message);
  }

  // 2. Verify Reputation Manager
  console.log("\n2. Verifying ReputationManager...");
  try {
      await hre.run("verify:verify", {
      address: DEPLOYED_ADDRESSES.reputationManager,
      constructorArguments: [DEPLOYER_ADDRESS],
      });
      console.log("ReputationManager verified successfully!");
  } catch (e) {
      console.log("ReputationManager verification failed or already verified:", e.message);
  }

  // 3. Verify DAO Voting (Public)
  console.log("\n3. Verifying DAOVoting...");
  try {
      await hre.run("verify:verify", {
      address: DEPLOYED_ADDRESSES.daoVoting,
      constructorArguments: [
          DEPLOYED_ADDRESSES.governanceToken,
          DEPLOYER_ADDRESS
      ],
      });
      console.log("DAOVoting verified successfully!");
  } catch (e) {
      console.log("DAOVoting verification failed or already verified:", e.message);
  }

  // 4. Verify VoteVerifier (No constructor arguments - auto-generated by snarkJS)
  console.log("\n4. Verifying VoteVerifier...");
  try {
      await hre.run("verify:verify", {
      address: DEPLOYED_ADDRESSES.voteVerifier,
      // No constructor arguments - Groth16Verifier has no constructor
      });
      console.log("VoteVerifier verified successfully!");
  } catch (e) {
      console.log("VoteVerifier verification failed or already verified:", e.message);
  }

  // 5. Verify DID Registry
  console.log("\n5. Verifying DIDRegistry...");
  try {
      await hre.run("verify:verify", {
      address: DEPLOYED_ADDRESSES.didRegistry,
      constructorArguments: [DEPLOYER_ADDRESS], // Takes the initialOwner address
      });
      console.log("DIDRegistry verified successfully!");
  } catch (e) {
      console.log("DIDRegistry verification failed or already verified:", e.message);
  }

  // 6. Verify Private DAO Voting (THE ONE YOU NEED)
  console.log("\n6. Verifying PrivateDAOVoting...");
  try {
      await hre.run("verify:verify", {
      address: DEPLOYED_ADDRESSES.privateDaoVoting,
      constructorArguments: [
          DEPLOYED_ADDRESSES.governanceToken,
          DEPLOYED_ADDRESSES.voteVerifier,
          DEPLOYED_ADDRESSES.didRegistry
          // Notice: DEPLOYER_ADDRESS has been removed from here!
      ],
      });
      console.log("PrivateDAOVoting verified successfully!");
  } catch (e) {
      console.log("PrivateDAOVoting verification failed or already verified:", e.message);
  }
  
}

main()
  .then(() => process.exit(0))
  .catch((error) => {
    console.error(error);
    process.exit(1);
  });
